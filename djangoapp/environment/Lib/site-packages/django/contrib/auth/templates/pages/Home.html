<!DOCTYPE html>
<html lang="en">
<head>
  <title>Bootstrap Website Example</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script> 
</head>

<body style="background-color:white">
  <nav class="navbar navbar-expand-lg navbar-light bg" style="background-color: #FDF5DF;">
    <a class="navbar-brand" href="/">Capitalize</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
  
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="/">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/Transactions">Transactions</a>
        </li>       
      </ul>
      {% if user.is_authenticated %}

      <a class="nav-link" href="#" style="color:black;">Welcome, {{user.username}}</a>
       
      <form class="form-inline my-2 my-lg-0">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit" onclick="Logout()">Logout</button>
      </form>

      {% else %}
      

      <a class="btn btn-outline-success my-2 my-sm-0" href="/Register">Register</a>

      <span>&nbsp;&nbsp;&nbsp;</span>
      <a class="btn btn-outline-success my-2 my-sm-0" href="/Login">Login</a>
      {% endif %}
    </div>
  </nav>
<br>
<div class="container">
  <div class="row">
    <div class="col-sm-4">
      <button type="button" class="btn btn-outline-primary" id="ARIMA">ARIMA</button>
      <button type="button" class="btn btn-outline-primary" id="LSTM">LSTM</button>
      <br>
      <br>
      <h3>Stock Exchange</h3>
      <p>Select a model above and company below.</p>
      <ul class="list-group">
        {% for company in companies %}        
            <li class="list-group-item"  id="{{company.company_name}}" onclick="GetCompanyType(this.id)">{{company.company_name}}</li>
        {% endfor %}
      </ul>
    </div>
    

    <div class="col-sm-7">
      <br>
      <div>
        <label id="headerPredictions2">Today's Value: </label><div id="todaysValue" style="word-wrap:break-word; text-align: center;"></div>
        <br>
        <input style="width:50%; display:inline-block;"type="text" class="form-control" id="predictionInput" placeholder="Enter custom prediction" aria-describedby="basic-addon1" width="50%;"> 
        <button type="button" class="btn btn-outline-success" style="display:inline-block" onclick="GetCustomPrediction()" id="prediction">Predict</button>
        <input style="width:25%; display:inline-block;"type="text" class="form-control" placeholder="Place Value" id="enterValue" aria-describedby="basic-addon1"> 
        <button type="button" class="btn btn-outline-success" style="display:inline-block" onclick="PlaceValue()" >Enter</button>
      </div>
      <br>
      <button type="button" class="btn btn-outline-success" id="button1">1 Day(s)</button>
      <button type="button" class="btn btn-outline-success" id="button2">2 Day(s)</button>
      <button type="button" class="btn btn-outline-success" id="button3">3 Day(s)</button>
      <button type="button" class="btn btn-outline-success" id="button4">4 Day(s)</button>
      <button type="button" class="btn btn-outline-success" id="button5">5 Day(s)</button>
      <br>
      <label id="headerPredictions" style="display:none;">The predictions are as follows: </label><div id="predictions" style="word-wrap:break-word; text-align: center;"></div>
       <div class="fakeimg"><img id="graphic" src=""></div>
       <div id="test"> </div>
    </div>
  </div>
<div id="loading">
    <p><img src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/0.16.1/images/loader-large.gif" /></p>
</div>

</body>
</html>

<style>

#loading { 
       display:none; 
       position:fixed; 
       left:50%; 
       top:50%; 
       width:50%; 
       height:50%;
       background-image:url("transparentbg.png"); 
       
}
</style>

<script>
selected = "";
algorithmType = "";

function showLoading() {
    $("#loading").show();
}

function hideLoading() {
    $("#loading").hide();
}

$(window).on('load', function() {
    algorithmType = "ARIMA";
    selected = "BP";
    $("#BP").css("background-color","lightgrey"); 
    $("#ARIMA").removeClass("btn btn-outline-primary");
    $("#ARIMA").addClass("btn btn-primary");

})

function GetCompanyType(company) {
    selected = company;
    $(".list-group-item").css("background-color","white");
    $("#"+selected+"").css("background-color","lightgrey");
    value = $("#predictionInput").val(); 

    if(algorithmType == "ARIMA") {
      runPredictionARIMA(1, company);
    } else {
      runPredictionLSTM(1, company)
    }
}

function GetCustomPrediction() {
  value = $("#predictionInput").val(); 
  if(algorithmType == "ARIMA") {
    runPredictionARIMA(value, selected);
  } else {
    runPredictionLSTM(value, selected)
  }
}

$(document).ready(function() {
    $("#ARIMA").click(function(){
      algorithmType = "ARIMA";
      $("#LSTM").removeClass("btn btn-primary");
      $("#LSTM").addClass("btn btn-outline-primary");
      $("#ARIMA").removeClass("btn btn-outline-primary");
      $("#ARIMA").addClass("btn btn-primary");
      runPredictionARIMA(1, selected)
    });

    $("#LSTM").click(function(){
      algorithmType = "LSTM";
      $("#ARIMA").removeClass("btn btn-primary");
      $("#ARIMA").addClass("btn btn-outline-primary");
      $("#LSTM").removeClass("btn btn-outline-primary");
      $("#LSTM").addClass("btn btn-primary");
      runPredictionLSTM(1, selected)
    });

    $("#button1").click(function(){
      if(algorithmType == "ARIMA") {
        runPredictionARIMA(1, selected)
      } else {
        runPredictionLSTM(1, selected)
      }
    });
    $("#button2").click(function(){
      if(algorithmType == "ARIMA") {
        runPredictionARIMA(2, selected)
      } else {
        runPredictionLSTM(2, selected)
      }
    });
    $("#button3").click(function(){
      if(algorithmType == "ARIMA") {
        runPredictionARIMA(3, selected)
      } else {
        runPredictionLSTM(3, selected)
      }
    });
    $("#button4").click(function(){
      if(algorithmType == "ARIMA") {
        runPredictionARIMA(4, selected)
      } else {
        runPredictionLSTM(4, selected)
      }
    });
    $("#button5").click(function(){
      if(algorithmType == "ARIMA") {
        runPredictionARIMA(5, selected)
      } else {
        runPredictionLSTM(5, selected)
      }
    });
});


function runPredictionARIMA(value, selected) {
  showLoading();
  $.ajax({
    url: 'IndexCustom',
    type: 'get', // This is the default though, you don't actually need to always mention it
    data:{'predictionTime': value, 'company': selected},
    success: function(data) {
        hideLoading();
        const parseJson = JSON.parse(data);
        const getGraph = parseJson.graphic;
        $('#test').empty();
        $('#graphic').removeAttr('src')
        $("#graphic").attr("src", "data:image/png;base64,"+getGraph)
        $("#headerPredictions").show();
        $("#headerPredictions2").show();
        $("#predictions").text(parseJson.prediction);  
        $("#todaysValue").text(parseJson.currentValue);  
    },
    error: function (request, status, error) {
        console.log(error);
    }
}); 
}

function runPredictionLSTM(value, selected) {
  showLoading();
  $.ajax({
    url: 'GenerateNeuralNetwork',
    type: 'get', // This is the default though, you don't actually need to always mention it
    data:{ 'predictionTime': value, 'company': selected },
    success: function(data) {
       hideLoading();
       const parseJson = JSON.parse(data);
       const getGraph = parseJson.graphic;
       $('#graphic').removeAttr('src')
       $("#predictions").text(parseJson.prediction); 
       $("#headerPredictions").show(); 
       $("#headerPredictions2").show();
       $('#test').empty();
       $("#test").append(getGraph);     
       $("#todaysValue").text(parseJson.currentValue);    
    },
    error: function (request, status, error) {
        console.log(error);
    }
}); 
}

function PlaceValue() {
  currentPrediction = $("#predictions").text();
  value = $("#enterValue").val(); 
  alert(currentPrediction);
  $.ajax({
    url: 'PlaceTransaction',
    type: 'get', // This is the default though, you don't actually need to always mention it
    data:{ 'value': value, 'companyName': selected, 'algorithm': algorithmType, 'currentPrediction': currentPrediction },
    success: function(data) {
        //alert(value);
    },
    error: function (request, status, error) {
        console.log(error);
    }
}); 
}

function Logout() {
  $.ajax({
    url: 'logout',
    type: 'get', // This is the default though, you don't actually need to always mention it
    data:{ },
    success: function(data) {
      alert("You have successfully logged out");
      window.location.href = "/";
    },
    error: function (request, status, error) {
        console.log(error);
    }
}); 
}


</script>